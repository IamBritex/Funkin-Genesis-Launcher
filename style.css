/* style.css */

/* --- DEFINICIÓN DE TEMAS --- */
:root,
body[data-theme="funkin"] {
  --color-black: #111;
  --color-white: #f1f2f4;
  --color-grey-dark: #222;
  --color-grey-mid: #3f485a;
  --color-grey-light: #636d83;
  --color-accent: #fa6bbe;
  --color-accent-text: #111;
  --color-red-hover: #e53935;
  --color-green-hover: #43a047;
  --color-toast-icon: #4CAF50;
  --color-link: #fa6bbe;
}
body[data-theme="black-white"]{--color-black:#000;--color-white:#fff;--color-grey-dark:#111;--color-grey-mid:#222;--color-grey-light:#333;--color-accent:#fff;--color-accent-text:#000;--color-red-hover:#e53935;--color-green-hover:#43a047;--color-toast-icon:#4CAF50;--color-link:#00bcd4}
body[data-theme="light"]{--color-black:#f0f0f0;--color-white:#111;--color-grey-dark:#fff;--color-grey-mid:#ddd;--color-grey-light:#ccc;--color-accent:#007bff;--color-accent-text:#fff;--color-red-hover:#e53935;--color-green-hover:#43a047;--color-toast-icon:#4CAF50;--color-link:#007bff}
body[data-theme="high-contrast"]{--color-black:#000;--color-white:#fff;--color-grey-dark:#000;--color-grey-mid:#333;--color-grey-light:#555;--color-accent:#00ff00;--color-accent-text:#000;--color-red-hover:#ff0000;--color-green-hover:#00ff00;--color-toast-icon:#00ff00;--color-link:#00ff00}

/* --- ESTILOS DE SCROLLBAR --- */
::-webkit-scrollbar { width: 10px; }
::-webkit-scrollbar-track { background: var(--color-grey-dark); border-radius: 5px; }
::-webkit-scrollbar-thumb { background: var(--color-grey-light); border-radius: 5px; }
::-webkit-scrollbar-thumb:hover { background: var(--color-grey-mid); }


body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica,
    Arial, sans-serif;
  background-color: var(--color-black);
  color: var(--color-white);
  margin: 0;
  height: 100vh;
  overflow: hidden;
  cursor: default;
  transition: background-color 0.2s, color 0.2s;
  display: flex;
  flex-direction: column;
}

/* --- ESTILOS DE BARRA DE TÍTULO --- */
#title-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 40px;
  background-color: var(--color-grey-dark);
  border-bottom: 1px solid var(--color-grey-mid);
  flex-shrink: 0;
}

/* ¡¡¡CORRECCIÓN DE ARRASTRE!!!
  -webkit-app-region: drag permite arrastrar esta sección.
*/
.title-bar-drag-region {
  -webkit-app-region: drag;
  display: flex;
  align-items: center;
  flex-grow: 1;
  height: 100%;
  padding-left: 1em; 
}

.title-bar-left {
  display: flex;
  align-items: center;
  gap: 0.5em;
  font-weight: bold;
}
.title-icon {
  width: 24px;
  height: 24px;
}

/* ¡¡¡CORRECCIÓN DE ARRASTRE!!!
  -webkit-app-region: no-drag evita que los botones interfieran
  con el arrastre.
*/
.title-bar-right {
  display: flex;
  height: 100%;
  -webkit-app-region: no-drag;
}
.window-control-btn {
  width: 45px;
  height: 100%;
  background: transparent;
  border: none;
  color: var(--color-white);
  font-size: 0.9em;
  cursor: pointer;
  transition: background-color 0.2s;
}
.window-control-btn:hover {
  background-color: var(--color-grey-mid);
}
.window-control-btn.close-btn:hover {
  background-color: var(--color-red-hover);
  color: var(--color-white);
}
/* ------------------------------------- */

/* --- ESTILOS DE CURSOR PERSONALIZADO --- */
body.custom-cursor-enabled{cursor:url('cursor/cursor-default.png') 1 1,auto}
body.custom-cursor-enabled a,body.custom-cursor-enabled button,body.custom-cursor-enabled .install-item,body.custom-cursor-enabled .close-button,body.custom-cursor-enabled .modal-icon-preview,body.custom-cursor-enabled .action-btn,body.custom-cursor-enabled .resizer,body.custom-cursor-enabled .switch,body.custom-cursor-enabled .version-selector{cursor:url('cursor/cursor-pointer.png') 1 1,pointer}

.hidden { display: none !important; }

.app-layout { 
  display: flex; 
  flex-grow: 1;
  overflow: hidden;
}

.sidebar {
  width: 220px;
  background-color: var(--color-grey-dark);
  border-right: 1px solid var(--color-grey-mid);
  padding: 1.5em 1em;
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
  flex-shrink: 0;
  transition: width 0.2s ease, padding 0.2s ease, background-color 0.2s, border-color 0.2s;
  overflow: hidden;
  max-width: 500px;
}
.sidebar.collapsed { width: 0; padding-left: 0; padding-right: 0; border-right-color: transparent; }


.nav-top { width: 100%; }
.nav-item, .nav-button, .config-btn {
  display: block; width: 100%; padding: 0.8em 1em;
  margin-bottom: 0.5em;
  font-size: 1em; text-align: left;
  border-radius: 5px; cursor: pointer; box-sizing: border-box;
  font-weight: 500;
  white-space: nowrap;
}
.nav-item:hover, .config-btn:hover { background-color: var(--color-grey-mid); }
.nav-button {
  background-color: transparent;
  color: var(--color-accent);
  border: 1px solid var(--color-accent); 
  transition: all 0.2s ease;
}
.nav-button:hover { background-color: var(--color-accent); color: var(--color-accent-text); }
.nav-item i, .nav-button i, .config-btn i { margin-right: 0.8em; width: 20px; text-align: center; }
.config-btn { 
  border: none; color: var(--color-white);
  background-color: transparent;
  border: 1px solid var(--color-grey-light);
}
.config-btn:hover { background-color: var(--color-grey-mid); }

.sidebar-buttons-group { display: flex; width: 100%; margin-bottom: 0.5em; }
.config-btn { flex-grow: 1; margin-bottom: 0 !important; display: flex; align-items: center; overflow: hidden; }

#engine-list { flex-grow: 1; overflow-y: auto; margin-top: 1em; }
.install-item { display: flex; align-items: center; padding: 0.8em; margin-bottom: 0.5em; border-radius: 5px; cursor: pointer; border: 1px solid transparent; }
.install-item:hover { background-color: var(--color-grey-mid); }
.install-item.active { background-color: var(--color-grey-light); border: 1px solid var(--color-accent); }
.install-item.disabled { color: var(--color-grey-light); opacity: 0.5; cursor: not-allowed; }
.install-item.disabled:hover { background-color: transparent; }
.install-item img { width: 24px; height: 24px; border-radius: 4px; object-fit: cover; margin-right: 0.8em; flex-shrink: 0; }
.install-name { font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--color-white); }


/* --- ESTILOS DE REDIMENSIONADOR --- */
.resizer {
  width: 5px;
  background: var(--color-grey-light);
  cursor: col-resize;
  flex-shrink: 0;
  transition: background-color 0.2s;
  z-index: 10;
}
.resizer:hover { background: var(--color-accent); }
.resizer.collapsed { display: none; }

/* --- Contenido Principal --- */
.content {
  flex-grow: 1;
  overflow: hidden;
  position: relative;
  display: flex;
  flex-direction: column;
}

/* --- ESTILOS DE NOTICIAS --- */
#news-container { 
  max-width: 800px; 
  margin: 0 auto; 
  flex-grow: 1;
  overflow-y: auto;
  padding: 2em 3em;
}
.news-article h1,.news-article h2,.news-article h3{color:var(--color-white);border-bottom:1px solid var(--color-grey-light);padding-bottom:.3em}.news-article h1{font-size:1.8em}.news-article h2{font-size:1.5em}.news-article p{line-height:1.6;color:var(--color-white);opacity:.85}.news-article a{color:var(--color-link);text-decoration:none}.news-article a:hover{text-decoration:underline}.news-article code{background-color:var(--color-grey-dark);padding:.2em .4em;border-radius:4px;font-family:monospace;color:var(--color-link)}.news-article pre{background-color:var(--color-grey-dark);border:1px solid var(--color-grey-mid);padding:1em;border-radius:5px;overflow-x:auto;color:var(--color-white);opacity:.9}.news-article pre code{color:inherit;background-color:transparent;padding:0}.news-article ul,.news-article ol{padding-left:1.5em}.news-article li{margin-bottom:.5em}

/* --- ESTILOS DE BARRA DE PROGRESO DE DESCARGA --- */
#download-progress-bar-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 1em;
  padding: 0.8em 3em;
  background-color: var(--color-grey-dark);
  border-top: 1px solid var(--color-grey-mid);
  flex-shrink: 0;
}
#download-status-text {
  font-size: 0.9em;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  flex-shrink: 1;
  opacity: 0.8;
}
#download-progress-bar-container .progress-bar-container {
  flex-grow: 1;
  height: 15px; /* Más delgada */
  margin: 0;
  background-color: var(--color-grey-light);
  border: 1px solid var(--color-grey-mid);
  border-radius: 10px;
  overflow: hidden;
}
#download-progress-bar-container .progress-bar-fill {
  width: 0%;
  height: 100%;
  background-color: var(--color-accent);
  transition: width 0.3s ease; /* Animación suave */
}

/* ¡¡¡CORRECCIÓN DE JITTER!!!
  Se establece un min-width más grande para que quepa 
  "XXX.XMB / XXX.XMB" sin "empujar" la barra.
*/
.download-progress-details {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  flex-shrink: 0;
  min-width: 140px; /* Incrementado para evitar saltos */
  text-align: right;
}
#download-percent-text {
  font-size: 0.9em;
  font-weight: bold;
}

/* ¡¡¡CORRECCIÓN DE JITTER!!!
  Se establece un min-height para que el espacio esté
  reservado incluso si el texto (MB) aún no ha aparecido.
*/
#download-size-text {
  font-size: 0.8em;
  opacity: 0.7;
  min-height: 1.2em; /* Reserva espacio vertical */
}


/* --- ESTILOS DEL FOOTER --- */
.content-footer {
  flex-shrink: 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1em 3em;
  background-color: var(--color-grey-dark);
  border-top: 1px solid var(--color-grey-mid);
  position: relative;
}

/* Ocultar borde del footer si la barra de descarga está visible */
#download-progress-bar-container:not(.hidden) + .content-footer {
  border-top: none;
}


/* --- ESTILOS SELECTOR DE VERSIÓN --- */
.version-selector {
  display: flex;
  align-items: center;
  gap: 0.8em;
  background-color: var(--color-black);
  border: 1px solid var(--color-grey-mid);
  padding: 0.5em 0.8em;
  border-radius: 6px;
  cursor: pointer;
  transition: border-color 0.2s;
  box-sizing: border-box; 
}
.version-selector:hover { border-color: var(--color-accent); }
.version-selector .engine-icon { width: 32px; height: 32px; border-radius: 4px; }
.version-selector-info { display: flex; flex-direction: column; }
#footer-engine-name { font-size: 1.1em; font-weight: bold; color: var(--color-white); }
#footer-version-number { font-size: 0.9em; color: var(--color-grey-light); }
.version-selector i { margin-left: 0.5em; color: var(--color-grey-light); }

/* Estilo para el botón de Play en el footer */
.content-footer #play-btn{width:auto;padding:.8em 1.5em;font-size:1.1em;font-weight:bold;background-color:var(--color-accent);color:var(--color-accent-text);border-color:var(--color-accent);margin-bottom:0}
.content-footer #play-btn:hover{filter:brightness(1.2)}
.content-footer #play-btn:disabled{background-color:var(--color-grey-light);color:var(--color-grey-mid);border-color:var(--color-grey-light);filter:none}


/* --- ESTILOS ADVERTENCIA OS --- */
.play-button-container {
  display: flex;
  align-items: center;
  gap: 1em;
}
.os-warning {
  position: relative;
  color: #f39c12;
  font-size: 1.5em;
  cursor: help;
  opacity: 0.8;
}
.os-warning #os-warning-tooltip {
  visibility: hidden;
  width: 220px;
  background-color: var(--color-black);
  color: var(--color-white);
  text-align: center;
  border-radius: 6px;
  padding: 8px;
  position: absolute;
  z-index: 5100;
  bottom: 125%;
  left: 50%;
  margin-left: -110px;
  opacity: 0;
  transition: opacity 0.3s;
  font-size: 0.7em;
  border: 1px solid var(--color-grey-mid);
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
  white-space: normal;
}
.os-warning:hover #os-warning-tooltip {
  visibility: visible;
  opacity: 1;
}

/* --- ESTILOS POPUP DE VERSIÓN --- */
#version-popup {
  position: absolute;
  /* Left y Width se calculan en JS para alineación perfecta */
  background-color: var(--color-black);
  border: 1px solid var(--color-grey-mid);
  border-bottom: none;
  border-radius: 6px 6px 0 0;
  box-shadow: 0 -5px 15px rgba(0,0,0,0.3);
  z-index: 5000;
  max-height: 250px;
  overflow-y: auto;
  box-sizing: border-box; 
}
.version-popup-item {
  padding: 0.8em 1em;
  color: var(--color-white);
  cursor: pointer;
  border-bottom: 1px solid var(--color-grey-mid);
  font-weight: 500;
  text-align: left; 
  white-space: nowrap; 
}
.version-popup-item:last-child { border-bottom: none; }
.version-popup-item:hover { background-color: var(--color-grey-mid); }
.version-popup-item.active {
  background-color: var(--color-accent);
  color: var(--color-accent-text);
  font-weight: bold;
}
/* --- ANIMACIONES DE MODAL --- */
@keyframes modalOpen{from{transform:scale(.9);opacity:0}to{transform:scale(1);opacity:1}}
@keyframes modalClose{from{transform:translateY(0);opacity:1}to{transform:translateY(50px);opacity:0}}
@keyframes blurFadeIn{from{backdrop-filter:blur(0px);background-color:rgba(0,0,0,0)}to{backdrop-filter:blur(5px);background-color:rgba(0,0,0,.5)}}
@keyframes blurFadeOut{from{backdrop-filter:blur(5px);background-color:rgba(0,0,0,.5)}to{backdrop-filter:blur(0px);background-color:rgba(0,0,0,0)}}

/* --- ESTILOS MODAL (Overlay) --- */
.blur-overlay{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000;display:flex;justify-content:center;align-items:center;animation:blurFadeIn .2s ease-out forwards}
.blur-overlay.closing{animation:blurFadeOut .2s ease-in forwards}
.modal-container{visibility:hidden;opacity:0}
.modal-container.hidden{display:none}
.modal-container:not(.hidden){display:flex;visibility:visible;opacity:1}
.modal{background-color:var(--color-grey-dark);border:1px solid var(--color-grey-mid);border-radius:10px;padding:2em;width:90%;max-width:400px;box-shadow:0 5px 20px rgba(0,0,0,.5);position:relative;text-align:center;animation:modalOpen .2s cubic-bezier(.175,.885,.32,1.275) forwards}
.modal-container.closing .modal{animation:modalClose .2s ease-in forwards}
.close-button{position:absolute;top:10px;right:15px;font-size:1.8em;font-weight:bold;color:var(--color-white);cursor:pointer;line-height:1}
.close-button:hover{color:var(--color-grey-light)}

/* Estilos de Formulario (reducido) */
.form-input,.form-select{width:100%;padding:.8em;box-sizing:border-box;background-color:var(--color-grey-mid);color:var(--color-white);border:1px solid var(--color-grey-light);border-radius:5px;font-size:1em}
.form-select:disabled{background-color:var(--color-grey-dark);color:var(--color-grey-light);border-color:var(--color-grey-mid)}
.modal-icon-preview{display:block;width:60px;height:60px;border-radius:8px;object-fit:cover;margin:0 auto 1em auto;cursor:pointer;border:1px dashed var(--color-grey-light);transition:border-color .2s}
.modal-icon-preview:hover{border-color:var(--color-accent)}

/* --- ESTILOS LOADING MODAL (Simplificado) --- */
#loading-overlay{z-index:2000}
#loading-overlay .modal { max-width: 300px; } /* Más pequeño */
#loading-status{ 
  font-size: 1.2em;
  font-weight: 500;
  text-align: center;
  white-space: normal;
  color: var(--color-white);
}
/* Estilos globales de barra de progreso (usados por la nueva barra) */
.progress-bar-container{width:100%;height:20px;background-color:var(--color-grey-light);border:1px solid var(--color-grey-mid);border-radius:10px;overflow:hidden}
.progress-bar-fill{width:0%;height:100%;background-color:var(--color-accent);transition:width .1s ease-out}
#loading-percent{display:block;margin-top:.5em;font-size:.9em;font-weight:bold}


/* --- ESTILOS CONFIRM MODAL --- */
.confirm-modal{max-width:420px}
.confirm-modal h2{margin-top:0}
.confirm-modal p{color:var(--color-white);opacity:.85;line-height:1.5;font-size:1.1em}
.confirm-actions{display:flex;justify-content:flex-end;gap:1em;margin-top:1.5em}
.confirm-actions .nav-button{font-weight:bold;margin-bottom:0;flex-grow:1}
.confirm-yes{background-color:var(--color-accent);color:var(--color-accent-text);border-color:var(--color-accent)}
.confirm-yes:hover{background-color:var(--color-green-hover);border-color:var(--color-green-hover);color:var(--color-white)}
.confirm-no{background-color:transparent;color:var(--color-white);border-color:var(--color-grey-mid)}
.confirm-no:hover{background-color:var(--color-red-hover);border-color:var(--color-red-hover);color:var(--color-white)}

/* --- ESTILOS CONFIG MODAL --- */
.config-modal{max-width:500px;text-align:left}
.config-modal h2{text-align:center;margin-top:0}
.config-option{display:flex;justify-content:space-between;align-items:center;padding:1em;margin-bottom:.5em;background-color:var(--color-black);border:1px solid var(--color-grey-mid);border-radius:6px}
.config-option label{font-weight:500}
.config-option .form-select{width:150px}

/* --- ESTILOS SWITCH --- */
.switch{position:relative;display:inline-block;width:50px;height:28px}
.switch input{opacity:0;width:0;height:0}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:var(--color-grey-light);transition:.4s}
.slider:before{position:absolute;content:"";height:20px;width:20px;left:4px;bottom:4px;background-color:var(--color-white);transition:.4s}
input:checked + .slider{background-color:var(--color-accent)}
input:checked + .slider:before{transform:translateX(22px);background-color:var(--color-accent-text)}
.slider.round{border-radius:34px}
.slider.round:before{border-radius:50%}

/* --- ESTILOS TOAST --- */
@keyframes fadeInOut{0%{opacity:0;transform:translate(-50%,20px)}15%{opacity:1;transform:translate(-50%,0)}85%{opacity:1;transform:translate(-50%,0)}100%{opacity:0;transform:translate(-50%,20px)}}
#toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background-color:var(--color-grey-dark);color:var(--color-white);border:1px solid var(--color-accent);padding:1em 1.5em;border-radius:8px;z-index:3000;box-shadow:0 4px 10px rgba(0,0,0,.5);display:flex;align-items:center;opacity:0}
#toast.show{opacity:1;animation:fadeInOut 3s ease-out forwards}
#toast i{color:var(--color-toast-icon);margin-right:.8em;font-size:1.2em}


/* --- Estilos para bloquear UI durante descarga --- */
body.is-downloading .install-item {
  pointer-events: none;
  opacity: 0.6;
}
body.is-downloading .version-selector {
  pointer-events: none;
  opacity: 0.6;
  cursor: not-allowed;
}
body.is-downloading .install-item:hover {
  background-color: transparent;
}
body.is-downloading .install-item.active {
  background-color: var(--color-grey-light); /* Mantener activo visible */
  opacity: 0.8;
}